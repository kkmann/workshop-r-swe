---
title: "Publication"
author: "Daniel, Friedrich"
format: 
  revealjs: 
    fontsize: 32px
description: "How to prepare the R package for publication, incl. documentation, license, checks. Photo CC0 by Andrea Piacquadio on pexels.com."
image: thumbnails/publish.jpg
---

# Website with `pkgdown`

## Setup of `pkgdown`

- `pkgdown` makes it quick and easy to build a website for your package
- After installing `pkgdown`, just use `usethis::use_pkgdown()` to get started
- Main configuration happens in `_pkgdown.yml` file
- Many customizations can be applied, but main work during development is to 
  keep the `reference` section updated with names of `.Rd` files
  
## Example `_pkgdown.yml` file

```yaml
---
url: https://openpharma.github.io/mmrm

template:
  bootstrap: 5
  params:
    ganalytics: UA-125641273-1

navbar:
  right:
    - icon: fa-github
      href: https://github.com/openpharma/mmrm

reference:
  - title: Package
    contents:
      - mmrm-package
  - title: Functions
    contents:
      - mmrm
      - fit_mmrm
      - mmrm_control
      - fit_single_optimizer
      - refit_multiple_optimizers
      - df_1d
      - df_md
      - component
```

## Publication as GitHub Page

- It is helpful for users to read the website online
- GitHub is very helpful here because it allows
  - A separate branch `gh-pages` that stores the rendered website
  - GitHub actions automatically render the website when the `main` branch
    is updated
- To get started, use `usethis::use_pkgdown_github_pages()`

##  {background-iframe="https://openpharma.github.io/mmrm/main/" background-interactive="true"}

# Licensing, Open sourcing, Versioning

## Licensing

- High level categorization of licenses:
  - "Permissive": Relaxed. Can be freely copied, modified, published (under the same license).
  - "Copyleft": Stricter. Same rights need to be preserved in derivative works.
- R itself is licensed with the GPL, but packages can choose the license
    - e.g. `usethis::use_mit_license()` for permissive MIT 
    - or `usethis::use_gpl_license()` for copyleft GPL
- Need to be careful here when you bundle any code from other software
  - Are the licenses of your package and the source compatible?

## Open Sourcing

- The easiest way to "open source" your R package is to make the GitHub repository public
- This allows for easy open source contributions from other developers via pull requests
- Please check with your organization first: 
  - Are they ok to publish the software?
  - What is the appropriate copyright holder? 
- Also allows bugs to be filed and to have
  the GitHub issues page in the package description
  
## Versioning

- The `Version` field gives the version of the package
- Syntax: At least two, usually three, integers separate by `.` or `-`
  - Canonical form is: `x.y-z`, but that is equivalent to `x.y.z`
- Useful conventions of "semantic versioning": 
  - `x` is major: Increment this for breaking changes
  - `y` is minor: Increment this for backwards-compatible new features
  - `z` is patch: Increment this for bug fixes only
  - `x.y.z.9000` and count up during development before the next release.
  - `usethis::use_version()` can help with this
- Keep in mind to update the `NEWS` file for any user-visible change

# Checks before Release

## CRAN (The Comprehensive R Archive Network)

- CRAN is the central repository for R packages
- It has additional requirements beyond the standard package ones, which are 
  described in the Repository Policy
- Submitting a package indicates agreement with the policy
- In particular: "The time of the volunteers is CRANâ€™s most precious resource, and they reserve the right to remove or modify packages on CRAN without notice or explanation (although notification will usually be given)."

## CRAN (cont'd)

- Only source packages can be submitted, no binary executables are allowed
  - But `.rda` data files are allowed
- Need single designated maintainer (a person, not a mailing list)
  - Additional `Contact` field could be used
- Citations should be in the author-year style, followed by a `<doi:...>`
- Reducing run time of tests, checks, examples, vignettes is important
- Need to provide cross-platform portable code: CRAN runs checks on Windows, Mac, Linux OS

## R-Hub to the Rescue

::: columns
::: {.column width="30%"}
![](resources/r-hub.png)
:::

::: {.column width="70%"}
- Free `R CMD check` runs on [different operating systems](https://docs.r-hub.io/#which-platform) before submitting to CRAN
- Supported by the R consortium
- Typically used via the [website](https://builder.r-hub.io/)
- There is also an R API: `rhub::check_for_cran()` is comfortable
:::
:::

# GitHub

## Tags

- Tags are a feature of Git, i.e. not specific to GitHub
- Git can tag specific points in the code history as being important
- Typically, for each release you create a tag in the format `vx.y.z`
- The value here is that users can later check out the package 
  in the state of this release version
  - Download in R: `remotes::install_github("org/package", ref = "vx.y.z")`
  - Comparison of versions are also possible, etc.

## Tags: Example

![](resources/tags.png)

## Releases

- Based on Git tags, and a feature of GitHub
- Are "deployable software packages to make them available for a wider audience to download and use"
- Contain release notes and links to the binary package files for download
  - However, for R packages these `tar.gz` package files are rarely used directly

## Releases: Example

![](resources/releases.png)

# References

- [Licensing chapter](https://r-pkgs.org/license.html)
- [All possible licenses for CRAN packages](https://svn.r-project.org/R/trunk/share/licenses/license.db)
- [GitHub releases](https://docs.github.com/en/repositories/releasing-projects-on-github/about-releases)
- [CRAN Repository Policy](https://cran.r-project.org/web/packages/policies.html)
- [R-hub builder](https://builder.r-hub.io/)

# Exercise


